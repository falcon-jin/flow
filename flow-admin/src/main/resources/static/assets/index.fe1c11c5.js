import{A as k,ao as E,ba as O,cy as z,c3 as N,b_ as W,r as S,a0 as s,B as $,a1 as H,a6 as t,w as a,H as D,u as b,ae as j}from"./vendor.5879c5ca.js";/* empty css               *//* empty css                *//* empty css                */import{B as U}from"./TableImg.56f74f95.js";import{T as V}from"./BasicForm.bfb70ce4.js";import{u as K}from"./useTable.df715f1a.js";import{g as L,a as M,d as J,b as q}from"./role.56cae01d.js";import{P as G}from"./index.37a89528.js";import Q from"./CompanyTree.b920082a.js";import{_ as X,h as Y}from"./index.aeb7d9f7.js";import{b as A}from"./index.309f7e13.js";import{R as Z,s as I,c as ee,p as oe}from"./RoleModal.4a687f1e.js";import ne from"./index.8e79988e.js";import{b as ae}from"./personal.6a9b7edd.js";/* empty css                *//* empty css              */import"./useForm.9d0149a6.js";/* empty css                *//* empty css                */import"./uuid.2b29000c.js";import"./useWindowSizeFn.6a6adedd.js";/* empty css               */import"./useSortable.514a2720.js";/* empty css                *//* empty css                *//* empty css               *//* empty css               */import"./index.661e65ad.js";/* empty css                *//* empty css                *//* empty css                */import"./download.6c7231a4.js";import"./base64Conver.bb012c73.js";import"./index.77bdba74.js";/* empty css                *//* empty css                */import"./useContentViewHeight.6345b5e8.js";import"./Tree.vue_vue_type_style_index_0_lang.6dd32286.js";import"./useContextMenu.c42040e5.js";import"./company.711332d1.js";import"./constantEnum.82824ec7.js";import"./OrgTree.c66e561f.js";import"./dept.1a4c42ff.js";const{createMessage:se}=Y(),te=k({name:"RoleManagement",components:{BasicTable:U,PageWrapper:G,CompanyTree:Q,RoleModal:Z,PersonalSelector:ne,TableAction:V,Input:E,Tag:O,Affix:z,Space:N,Search:E.Search,SettingOutlined:W},setup(){const[n,{openModal:x}]=A(),[B,{openModal:T,setModalProps:R}]=A(),r=S({}),p=S([]),d=S({}),m=S({});I.forEach(e=>{e&&(e.componentProps.onkeypress=o=>{o.keyCode===13&&u()})});const[f,{reload:u}]=K({title:"\u5217\u8868",api:L,columns:ee,formConfig:{labelWidth:120,schemas:I,showAdvancedButton:!1,showResetButton:!1,autoSubmitOnEnter:!0},expandRowByClick:!0,useSearchForm:!0,showIndexColumn:!1,showTableSetting:!1,bordered:!1,pagination:!0,onExpand:(e,o)=>{e?(r.value=o,d.value[o.id]="",c(o.id,d.value[o.id])):p.value=[]},rowKey:"id",canResize:!1});function h(){x(!0,{isUpdate:!1})}function P(e,o){o.stopPropagation(),x(!0,{record:e,isUpdate:!0})}function c(e,o){M({roleId:e,personal:{keyword:o||""}}).then(i=>{m.value[e]=i})}function g(e,o){o.stopPropagation(),r.value=e,M({roleId:e.id}).then(i=>{T(!0,{selectorProps:{multiSelect:!0,selectedList:i.map(F=>({code:F.code,name:F.name}))}}),R({title:`\u8BBE\u7F6E\u89D2\u8272\u3010${e.name}\u3011\u4E0B\u7684\u4EBA\u5458`,bodyStyle:{padding:"0px",margin:"0px"},width:850,height:450,showOkBtn:!0,showCancelBtn:!1})}).finally(()=>{})}function C(e){if(e.children&&e.children.length>0){se.warning("\u6709\u5B50\u8282\u70B9\uFF0C\u4E0D\u80FD\u5220\u9664\uFF01");return}J([e.id]).then(o=>{u()})}function y(e){ae({roleId:e.roleId,personalId:e.personalId}).then(()=>{c(e.roleId,"")})}function w(){u()}function l(e,o){c(e,o)}function _(e){console.log(JSON.stringify(e));const o=e.map(i=>({id:i.id,code:i.code}));q({roleId:b(r).id,personalList:o}).then(()=>{p.value=[b(r).id],c(b(r).id,d.value[b(r).id])})}function v(e){u({searchInfo:{companyId:e?e.id:""}})}return{personalColumns:oe,currentRole:r,rolePersonalData:m,onSearchPerson:l,searchPersonTxt:d,registerTable:f,registerModal:n,registerPersonalModal:B,handleCreate:h,handleEdit:P,handleAddPersonal:g,handleDelete:C,handleDeletePersonal:y,handleSuccess:w,handleSettingPersonalSuccess:_,handleSelect:v}}}),le=j("\u65B0\u589E"),ie=j(" \u59D3\u540D "),re={class:"manager-range",style:{"text-align":"right"}},de=j("\u4E2D\u56FD\u77F3\u5316"),ue=j("\u4E2D\u56FD\u77F3\u5316");function ce(n,x,B,T,R,r){const p=s("CompanyTree"),d=s("Affix"),m=s("a-button"),f=s("TableAction"),u=s("Search"),h=s("Tag"),P=s("Space"),c=s("SettingOutlined"),g=s("BasicTable"),C=s("RoleModal"),y=s("PersonalSelector"),w=s("PageWrapper");return $(),H(w,{dense:"",contentFullHeight:"",contentClass:"flex"},{default:t(()=>[a(d,{"offset-top":"8",class:"w-1/4 xl:w-1/5"},{default:t(()=>[a(p,{contentFullHeight:"",onSelect:n.handleSelect},null,8,["onSelect"])]),_:1}),a(g,{onRegister:n.registerTable,class:"personal w-3/4 xl:w-4/5"},{toolbar:t(()=>[a(m,{type:"primary",onClick:n.handleCreate},{default:t(()=>[le]),_:1},8,["onClick"])]),action:t(({record:l})=>[a(f,{actions:[{tooltip:"\u6DFB\u52A0\u4EBA\u5458",icon:"ant-design:user-add",onClick:n.handleAddPersonal.bind(null,l)},{tooltip:"\u4FEE\u6539",icon:"clarity:note-edit-line",onClick:n.handleEdit.bind(null,l)},{tooltip:"\u5220\u9664",icon:"ant-design:delete-outlined",color:"error",onClick:_=>{_.stopPropagation()},popConfirm:{title:"\u662F\u5426\u786E\u8BA4\u5220\u9664",confirm:n.handleDelete.bind(null,l)}}]},null,8,["actions"])]),expandedRowRender:t(({record:l,index:_,indent:v,expanded:e})=>[a(g,{title:"",size:"small",columns:n.personalColumns,useSearchForm:!1,immediate:!1,showIndexColumn:!0,showTableSetting:!1,bordered:!0,pagination:!1,actionColumn:`{\r
            align: 'center'\r
          }`,rowKey:"id",canResize:!1,searchInfo:{roleId:l.id},dataSource:n.rolePersonalData[l.id],class:"w-4/4 xl:w-5/5"},{customName:t(({rec:o})=>[D("span",null,[ie,a(u,{value:n.searchPersonTxt[l.id],"onUpdate:value":i=>n.searchPersonTxt[l.id]=i,placeholder:"\u59D3\u540D/\u5DE5\u53F7/\u624B\u673A",style:{width:"150px"},size:"small",allowClear:"",onSearch:i=>{n.onSearchPerson(l.id,i)}},null,8,["value","onUpdate:value","onSearch"])])]),action:t(({record:o})=>[a(f,{actions:[{icon:"ant-design:delete-outlined",color:"error",popConfirm:{title:"\u662F\u5426\u786E\u8BA4\u5220\u9664",confirm:n.handleDeletePersonal.bind(null,o)}}]},null,8,["actions"])]),setManagerRange:t(({record:o})=>[D("div",re,[a(P,{size:"small"},{default:t(()=>[a(h,{color:"processing"},{default:t(()=>[de]),_:1}),a(h,{color:"processing"},{default:t(()=>[ue]),_:1})]),_:1}),a(c,{class:"ant-btn-link"})])]),_:2},1032,["columns","searchInfo","dataSource"])]),_:1},8,["onRegister"]),a(C,{onRegister:n.registerModal,onSuccess:n.handleSuccess},null,8,["onRegister","onSuccess"]),a(y,{onRegister:n.registerPersonalModal,onSuccess:n.handleSettingPersonalSuccess},null,8,["onRegister","onSuccess"])]),_:1})}var no=X(te,[["render",ce]]);export{no as default};
