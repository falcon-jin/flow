var H=Object.defineProperty,N=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var _=(e,s,a)=>s in e?H(e,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[s]=a,M=(e,s)=>{for(var a in s||(s={}))W.call(s,a)&&_(e,a,s[a]);if(F)for(var a of F(s))P.call(s,a)&&_(e,a,s[a]);return e},w=(e,s)=>N(e,O(s));var A=(e,s,a)=>new Promise((p,u)=>{var l=r=>{try{n(a.next(r))}catch(d){u(d)}},i=r=>{try{n(a.throw(r))}catch(d){u(d)}},n=r=>r.done?p(r.value):Promise.resolve(r.value).then(l,i);n((a=a.apply(e,s)).next())});import{B as q,a as J}from"./index.309f7e13.js";import{B as K}from"./TableImg.56f74f95.js";import{B as Q}from"./BasicForm.bfb70ce4.js";import{u as X}from"./useTable.df715f1a.js";import{u as Y}from"./useForm.9d0149a6.js";import{b as Z,d as ee}from"./group.data.b6b56eb1.js";import{b as oe}from"./account.c73985c3.js";import{A as se,g as G,s as ae}from"./AclCheckboxGroup.cbe16084.js";import{a$ as R,A as te,bD as re,r as f,u as E,a0 as g,B as le,a1 as ie,a6 as b,w as x,H as ne,a4 as ce,ae as ue}from"./vendor.5879c5ca.js";/* empty css              */import{_ as de,aV as z}from"./index.aeb7d9f7.js";import"./useWindowSizeFn.6a6adedd.js";/* empty css                */import"./index.37a89528.js";/* empty css                *//* empty css                */import"./useContentViewHeight.6345b5e8.js";/* empty css                *//* empty css                *//* empty css               */import"./uuid.2b29000c.js";/* empty css               */import"./useSortable.514a2720.js";/* empty css                *//* empty css                *//* empty css               *//* empty css               */import"./index.661e65ad.js";/* empty css                *//* empty css                *//* empty css                */import"./download.6c7231a4.js";import"./base64Conver.bb012c73.js";import"./index.77bdba74.js";const me=R.Group,pe=te({name:"SetAclModal",components:{BasicModal:q,BasicTable:K,BasicForm:Q,Select:re,Checkbox:R,CheckboxGroup:me,AclCheckboxGroup:se},emits:["success","register"],setup(e,{emit:s}){const a=f(!0),p=f(""),u=f([]),l=f(!0),i=f(!1),n=f(!1),[r,{setFieldsValue:d,updateSchema:B,resetFields:h,validate:j}]=Y({labelWidth:100,schemas:Z,showActionButtonGroup:!1,actionColOptions:{span:0}}),[c,{getDataSource:k,setTableData:L,reload:ge,expandAll:S}]=X({title:"",size:"small",dataSource:u,loading:l,immediate:!1,searchInfo:{},columns:ee,formConfig:{labelWidth:120},canResize:!0,maxHeight:400,isTreeTable:!0,useSearchForm:!1,showTableSetting:!1,bordered:!1,showIndexColumn:!1,pagination:!1}),[V,{setModalProps:C,closeModal:$}]=J(o=>A(this,null,function*(){if(h(),C({confirmLoading:!1,title:"\u7ED9\u7EC4\u3010"+o.record.name+"("+o.record.sn+")\u3011\u8BBE\u7F6E\u6743\u9650"}),a.value=!!(o==null?void 0:o.isUpdate),E(a)){let t=o.record.groups||[];t=t.map(m=>m.id),d(w(M({},o.record),{groups:t})),p.value=o.record.id}l.value=!0,G({groupId:o.record.id}).then(t=>{T(t),u.value=t,l.value=!1,setTimeout(()=>{S()})})}));function T(o){let t=0,m=0,v=0;z(o,I=>{I.pvs&&I.pvs.forEach(D=>{t++,D.flag?m++:v++})}),m===t?(n.value=!0,i.value=!1):v===t?(n.value=!1,i.value=!1):i.value=!0}function y(){return A(this,null,function*(){try{C({confirmLoading:!0});const o=yield j();o.groups=o.groups.map(t=>({id:t})),o.userId=o.id,delete o.id,yield oe(o),$(),s("success")}finally{C({confirmLoading:!1})}})}function U(){G({groupId:p.value}).then(o=>{T(o)})}return{registerTable:c,registerModal:V,indeterminate:i,registerForm:r,checkAllBox:n,handelChangeCheckAllStatus:U,checkAll:o=>{l.value=!0,i.value=!1,ae({checked:o.target.checked?1:0,aclInfo:{releaseId:E(p)}}).then(t=>{z(u.value,m=>{m.pvs&&m.pvs.forEach(v=>{v.flag=o.target.checked})}),L(u.value),l.value=!1,setTimeout(()=>{S()})}).catch(()=>{l.value=!1})},handleSubmit:y}}}),fe=ue("\u5168\u9009");function he(e,s,a,p,u,l){const i=g("Checkbox"),n=g("AclCheckboxGroup"),r=g("BasicTable"),d=g("BasicForm"),B=g("BasicModal");return le(),ie(B,ce(e.$attrs,{onRegister:e.registerModal,onOk:e.handleSubmit}),{default:b(()=>[x(d,{onRegister:e.registerForm},{acls:b(({model:h,field:j})=>[x(r,{value:h[j],"onUpdate:value":c=>h[j]=c,onRegister:e.registerTable},{customTitle:b(()=>[ne("span",null,[x(i,{checked:e.checkAllBox,"onUpdate:checked":s[0]||(s[0]=c=>e.checkAllBox=c),indeterminate:e.indeterminate,onClick:e.checkAll},{default:b(()=>[fe]),_:1},8,["checked","indeterminate","onClick"])])]),pvs:b(({record:c})=>[x(n,{onChangeCheckAllStatus:e.handelChangeCheckAllStatus,checkboxList:c.pvs.map(k=>({label:k.name,value:k.position,checked:k.flag})),groupId:h.id,moduleSn:c.sn,moduleId:c.id},null,8,["onChangeCheckAllStatus","checkboxList","groupId","moduleSn","moduleId"])]),_:2},1032,["value","onUpdate:value","onRegister"])]),_:1},8,["onRegister"])]),_:1},16,["onRegister","onOk"])}var Ze=de(pe,[["render",he]]);export{Ze as default};
